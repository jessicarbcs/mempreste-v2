angular.module('starter.services', [])

    .factory('Chats', function ($q, $firebaseArray) {
        return {
            pedidoEmprestimo: function (livro, pedinte) {
                let chat = {
                    livro: {
                        uid: livro.$id,
                        nome: livro.volumeInfo.title,
                        dono: {
                            nome: livro.dono.email,
                            uid: livro.dono.id
                        },
                        pedinte: {
                            nome: pedinte.email,
                            uid: pedinte.uid
                        }
                    },
                    status: 0
                }
                $firebaseArray(database.ref('chats')).$loaded(function(data){
                    data.$add(chat)
                })
            },
            chatsByUserAsPedinte: function (pedinte){
                let ref = $firebaseArray(database.ref().child('chats').orderByChild('livro/pedinte/uid').equalTo(pedinte.uid));
                return ref;
            }
        };
    })
    .factory('Books', function ($http, $firebaseArray) {
        return {
            findByIsbn: function (isbn) {
                return $http.get('https://www.googleapis.com/books/v1/volumes?q=isbn:' + isbn)
            }
        }
    })

    .factory('Auth', function ($firebaseAuth, $state) {
        let fireAuth = $firebaseAuth();
        let user = undefined;
        //
        let login = function (email, password) {
            fireAuth.$signInWithEmailAndPassword(email, password).then(function (res) {
                user = res.user;
                $state.go('tab.dash')
            }).catch(function (error) {
                console.error("Authentication failed:", error);
            });
        };
        let getUser = function () {
            return user;
        }
        let checkLogin = function () {
            if (user == undefined)
                $state.go('login')
        }
        let cadastro = function(cadastro){
            return fireAuth.$createUserWithEmailAndPassword(cadastro.email, cadastro.senha);
        }

        return {
            login: login,
            user: getUser,
            checkLogin: checkLogin,
            cadastro: cadastro,
            listaMatriculas: [
                "422376",
                "467043",
                "669938",
                "303323",
                "074008",
                "741323",
                "418351",
                "550474",
                "230438",
                "304416",
                "893655",
                "241845",
                "346664",
                "655733",
                "730540",
                "493376",
                "913767",
                "237679",
                "414707",
                "976673",
                "792736",
                "574357",
                "293655",
                "539942",
                "387306",
                "873074",
                "879237",
                "797421",
                "883767",
                "840835",
                "412892",
                "084944",
                "039039",
                "362387",
                "103655",
                "741742",
                "408793",
                "999834",
                "122034",
                "702365",
                "794184",
                "242795",
                "428436",
                "873113",
                "679940",
                "367357",
                "873768",
                "037680",
                "408389",
                "915684",
                "436542",
                "122401",
                "573976",
                "739710",
                "418466",
                "873124",
                "179137",
                "803346",
                "684133",
                "539819",
                "357935",
                "226623",
                "558138",
                "313376",
                "043655",
                "238731",
                "397178",
                "979013",
                "558336",
                "982346",
                "083986",
                "735793",
                "391511",
                "897693",
                "799235",
                "938376",
                "073975",
                "736558",
                "403962",
                "768084",
                "334337",
                "809367",
                "833655",
                "633644",
                "376854",
                "873154",
                "477839",
                "034397",
                "113873",
                "635793",
                "376855",
                "905943",
                "681034",
                "669413",
                "583873",
                "837681",
                "387319",
                "768563",
                "828935",
                "940391",
                "693800",
                "439638",
                "412810",
                "977384",
                "390835",
                "199387",
                "223655",
                "940337",
                "398046",
                "873234",
                "033835",
                "944399",
                "633768",
                "242208",
                "416782",
                "467073",
                "794535",
                "946414",
                "183917",
                "938809",
                "357948",
                "147833",
                "732535",
                "949412",
                "954087",
                "538732",
                "346683",
                "146003",
                "617241",
                "625376",
                "153768",
                "636559",
                "376817",
                "181553",
                "732740",
                "796387",
                "283873",
                "040879",
                "365596",
                "151524",
                "781740",
                "995411",
                "774128",
                "439863",
                "397136",
                "983844",
                "296739",
                "059418",
                "214022",
                "035801",
                "388429",
                "037934",
                "849536",
                "598387",
                "313979",
                "936560",
                "376819",
                "126694",
                "325138",
                "333422",
                "683579",
                "341287",
                "338969",
                "005253",
                "798434",
                "671376",
                "203922",
                "238733",
                "376866",
                "800953",
                "682134",
                "667400",
                "973873",
                "536560",
                "401007",
                "579563",
                "936140",
                "717357",
                "573768",
                "241343",
                "387336",
                "182273",
                "682538",
                "770376",
                "273768",
                "839798",
                "428692",
                "131233",
                "682936",
                "615352",
                "614131",
                "940021",
                "376830",
                "768314",
                "066236",
                "590387",
                "373768",
                "441273",
                "346674",
                "030793",
                "796041",
                "940400",
                "853993",
                "938734",
                "397193",
                "146013",
                "606038",
                "341387",
                "423978",
                "435796",
                "346663",
                "768383",
                "560741",
                "455346",
                "124006",
                "736560",
                "357967",
                "003213",
                "687238",
                "344421",
                "693873",
                "539606",
                "399686",
                "087973",
                "561037",
                "504392",
                "124221",
                "736961",
                "323370",
                "873463",
                "796938",
                "347357",
                "723963",
                "237169",
                "357973",
                "003093",
                "561140",
                "212365",
                "123768",
                "041167",
                "323411",
                "371113",
                "684138",
                "351418",
                "414132",
                "835797",
                "346682",
                "656133",
                "667232",
                "379387",
                "523656",
                "439886",
                "392283",
                "679863",
                "684339",
                "383369",
                "183358",
                "737684",
                "387354",
                "579783 ",
                "379408",
                "768453",
                "561636",
                "012370",
                "333794",
                "937941",
                "376796",
                "768473",
                "798836",
                "617367",
                "893656",
                "835798",
                "357985",
                "713453",
                "685135",
                "990365",
                "233656",
                "537941",
                "357991",
                "679903",
                "685236",
                "193365",
                "293794",
                "236119",
                "360015",
                "611943",
                "563037",
                "346358",
                "033713",
                "736563",
                "376858",
                "656323",
                "941337",
                "813376",
                "593580",
                "836799",
                "357950",
                "768603",
                "800937",
                "862379",
                "173794",
                "838266",
                "358016",
                "699053",
                "686435",
                "017365",
                "363768",
                "536563",
                "365638",
                "794193",
                "686736",
                "996365",
                "413794",
                "037682",
                "376868",
                "713493",
                "799737",
                "422376",
                "323768",
                "337686",
                "376870",
                "699083",
                "942336",
                "647379",
                "243699",
                "935802",
                "358026",
                "768713",
                "266838",
                "980357",
                "703826",
                "937135",
                "379427",
                "768733",
                "687436",
                "652358",
                "303768",
                "537687",
                "371708 ",
                "387355",
                "985333",
                "487639",
                "573387",
                "183873",
                "739960",
                "406682",
                "873604",
                "057840",
                "850397",
                "893987",
                "140220",
                "400394",
                "941614",
                "516740",
                "637393",
                "674066",
                "938736",
                "398760",
                "984593",
                "059539",
                "799387",
                "673873",
                "438977",
                "397922",
                "964373",
                "736638",
                "772389",
                "734085",
                "239710",
                "408503",
                "970144",
                "722939",
                "891400",
                "303873",
                "839262",
                "387370",
                "873723",
                "606440",
                "599393",
                "443948",
                "739643",
                "398758",
                "050244",
                "240940",
                "851398",
                "433873",
                "540885",
                "390596",
                "083033",
                "411838",
                "775400",
                "523873",
                "640131",
                "403306",
                "873774",
                "885340",
                "572400",
                "163975",
                "439059",
                "396439",
                "071943",
                "933340",
                "660396",
                "663873",
                "938738",
                "398370",
                "939993",
                "059840",
                "520398",
                "483873",
                "140304",
                "406783",
                "987974",
                "122538",
                "382397",
                "033914",
                "639391",
                "387384",
                "984853",
                "400339",
                "442408",
                "044000",
                "438738",
                "408867",
                "088544",
                "008539",
                "633398",
                "033873",
                "838738",
                "387390",
                "948794",
                "885538",
                "393393",
                "504088",
                "640776",
                "389776",
                "069304",
                "776240",
                "078390",
                "994005",
                "240223",
                "396443",
                "066614",
                "452038",
                "396405",
                "053966",
                "039784",
                "399538",
                "066623",
                "739839",
                "880392"
            ]
        };
    });
